'use client'

import { useState, useTransition } from 'react'
import { createHype } from '@/app/actions/hype'

export default function HypeComposer() {
  const [content, setContent] = useState('')
  const [pending, start] = useTransition()
  const [msg, setMsg] = useState<string | null>(null)

  const submit = (e: React.FormEvent) => {
    e.preventDefault()
    setMsg(null)
    const fd = new FormData()
    fd.set('content', content)
    start(async () => {
      const res = await createHype(fd)
      if (!res.ok) return setMsg(res.error || 'Something went wrong')
      setContent('')
      setMsg('Sent! ðŸŽ‰')
      setTimeout(() => setMsg(null), 1500)
    })
  }

  return (
    <form onSubmit={submit} className="rounded-2xl border border-white/10 bg-white/[0.05] p-4">
      <label className="block text-sm text-white/70 mb-2">Tell your friends what you need hype for</label>
      <textarea
        value={content}
        onChange={(e) => setContent(e.target.value)}
        placeholder="Big game? Interview? First day? Drop a lineâ€¦"
        className="w-full resize-none rounded-xl border border-white/15 bg-white/[0.06] px-3 py-3 outline-none text-white min-h-[90px]"
      />
      <div className="mt-3 flex items-center gap-3">
        <button
          type="submit"
          disabled={pending || !content.trim()}
          className="rounded-full px-4 py-2 brand-gradient text-white shadow-brand disabled:opacity-60"
        >
          {pending ? 'Postingâ€¦' : 'Post hype request'}
        </button>
        {msg && <span className="text-sm text-white/70">{msg}</span>}
      </div>
    </form>
  )
}